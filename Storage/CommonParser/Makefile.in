CXX_OPTS=-Wall -std=c++11 -O3 -fPIC -g -mavx -Wa,-q
CXX=g++

ifndef SOURCE_ROOT
SOURCE_ROOT=/Users/jcassidy/src
endif

ifndef ANTLR_INCLUDE
ANTLR_INCLUDE=/usr/local/antlr3c-3.4/include
endif

ifndef ANTLR_LIB
ANTLR_LIB=/usr/local/antlr3c-3.4/lib
endif

ifndef ANTLR
ANTLR=java -jar /usr/local/antlrv3/antlr-3.5.2-complete-no-st3.jar
endif

ifndef TCL_LIB
TCL_LIB=/usr/local/lib
endif

%_tokens.h: %.tokens
	cat $^ | $(SOURCE_ROOT)/FullMonteSW/Storage/CommonParser/mktok.pl > $@

%Parser.c %Lexer.c %Parser.h %Lexer.h %.tokens: %.g
	$(ANTLR) $^
	
%Parser.o: %Parser.c %Parser.h
	$(CXX) $(CXX_OPTS) -Wno-unused-variable -Wno-unused-but-set-variable -Wno-unused-function -I$(ANTLR_INCLUDE) -D_empty=NULL -c $*Parser.c 
	
%Lexer.o: %Lexer.c %Lexer.h
	$(CXX) $(CXX_OPTS) -Wno-unused-variable -Wno-unused-but-set-variable -Wno-unused-function -I$(ANTLR_INCLUDE) -D_empty=NULL -c $*Lexer.c
	
parser-clean:
	rm -f *Parser.h *Parser.c *Lexer.c *Lexer.h *_tokens.h *.tokens *Parser.o *Lexer.o

clean: parser-clean
