CXX_OPTS=-Wall -std=c++11 -O3 -fPIC -g -mavx
CXX=g++

ANTLR_INCLUDE=/usr/local/antlr3c-3.4/include
ANTLR_LIB=/usr/local/antlr3c-3.4/lib

ANTLR=java -jar /usr/local/antlrv3/antlr-3.5.2-complete-no-st3.jar

%_tokens.h: %.tokens
	cat $^ | ../CommonParser/mktok.pl > $@

%Parser.c %Lexer.c %Parser.h %Lexer.h %.tokens: %.g
	$(ANTLR) $^
	
%Parser.o: %Parser.c %Parser.h
	$(CXX) $(CXX_OPTS) -Wno-unused-variable -Wno-unused-but-set-variable -Wno-unused-function -I$(ANTLR_INCLUDE) -D_empty=NULL -c $*Parser.c 
	
%Lexer.o: %Lexer.c %Lexer.h
	$(CXX) $(CXX_OPTS) -Wno-unused-variable -Wno-unused-but-set-variable -Wno-unused-function -I$(ANTLR_INCLUDE) -D_empty=NULL -c $*Lexer.c
	
parser-clean:
	rm -f *Parser.h *Parser.c *Lexer.c *Lexer.h *_tokens.h *.tokens *Parser.o *Lexer.o